name: SLSA Release

on:
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      tag:
        description: 'Release tag to build (e.g., v1.4.0)'
        required: true
        type: string

permissions:
  contents: read

env:
  GO_VERSION: '1.22'

jobs:
  prepare-build-metadata:
    name: Prepare Build Metadata
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.metadata.outputs.version }}
      commit: ${{ steps.metadata.outputs.commit }}
      build_date: ${{ steps.metadata.outputs.build_date }}
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
        with:
          egress-policy: audit

      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          ref: ${{ github.event.release.tag_name || inputs.tag }}

      - name: Generate build metadata
        id: metadata
        run: |
          # Extract version from release tag or manual input
          VERSION="${{ github.event.release.tag_name || inputs.tag }}"

          # Get commit SHA from release or current ref
          COMMIT="${{ github.event.release.target_commitish || github.sha }}"

          # Use ISO 8601 basic format without colons for SLSA compatibility
          BUILD_DATE=$(date -u +%Y%m%dT%H%M%SZ)

          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "commit=${COMMIT}" >> $GITHUB_OUTPUT
          echo "build_date=${BUILD_DATE}" >> $GITHUB_OUTPUT
          echo "Generated metadata: version=${VERSION}, commit=${COMMIT}, date=${BUILD_DATE}"

  # ============================================
  # mcp-sysinfo builds
  # ============================================

  slsa-mcp-sysinfo-linux-amd64:
    name: SLSA Build mcp-sysinfo linux-amd64
    needs: [prepare-build-metadata]
    permissions:
      id-token: write
      contents: write
      actions: read
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.1.0
    with:
      go-version: "1.22"
      config-file: .slsa-goreleaser/mcp-sysinfo-linux-amd64.yml
      evaluated-envs: "VERSION:${{ needs.prepare-build-metadata.outputs.version }}, COMMIT:${{ needs.prepare-build-metadata.outputs.commit }}, BUILD_DATE:${{ needs.prepare-build-metadata.outputs.build_date }}"
      upload-assets: true
      private-repository: true

  slsa-mcp-sysinfo-linux-arm64:
    name: SLSA Build mcp-sysinfo linux-arm64
    needs: [prepare-build-metadata]
    permissions:
      id-token: write
      contents: write
      actions: read
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.1.0
    with:
      go-version: "1.22"
      config-file: .slsa-goreleaser/mcp-sysinfo-linux-arm64.yml
      evaluated-envs: "VERSION:${{ needs.prepare-build-metadata.outputs.version }}, COMMIT:${{ needs.prepare-build-metadata.outputs.commit }}, BUILD_DATE:${{ needs.prepare-build-metadata.outputs.build_date }}"
      upload-assets: true
      private-repository: true

  # ============================================
  # Darwin builds (native on macOS - no SLSA provenance)
  # SLSA builder only runs on Ubuntu, can't cross-compile CGO
  # ============================================

  build-mcp-sysinfo-darwin-amd64:
    name: Build mcp-sysinfo darwin-amd64
    runs-on: macos-latest
    needs: [prepare-build-metadata]
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          ref: ${{ github.event.release.tag_name || inputs.tag }}

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}
          cache: true

      - name: Build
        env:
          CGO_ENABLED: 1
          GOOS: darwin
          GOARCH: amd64
        run: |
          go build -trimpath \
            -ldflags="-s -w -X main.version=${{ needs.prepare-build-metadata.outputs.version }} -X main.commit=${{ needs.prepare-build-metadata.outputs.commit }} -X main.date=${{ needs.prepare-build-metadata.outputs.build_date }}" \
            -o mcp-sysinfo-darwin-amd64 \
            ./cmd/mcp-sysinfo

      - name: Upload to release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release upload ${{ github.event.release.tag_name || inputs.tag }} \
            mcp-sysinfo-darwin-amd64 \
            --repo ${{ github.repository }} \
            --clobber

  build-mcp-sysinfo-darwin-arm64:
    name: Build mcp-sysinfo darwin-arm64
    runs-on: macos-latest
    needs: [prepare-build-metadata]
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          ref: ${{ github.event.release.tag_name || inputs.tag }}

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}
          cache: true

      - name: Build
        env:
          CGO_ENABLED: 1
          GOOS: darwin
          GOARCH: arm64
        run: |
          go build -trimpath \
            -ldflags="-s -w -X main.version=${{ needs.prepare-build-metadata.outputs.version }} -X main.commit=${{ needs.prepare-build-metadata.outputs.commit }} -X main.date=${{ needs.prepare-build-metadata.outputs.build_date }}" \
            -o mcp-sysinfo-darwin-arm64 \
            ./cmd/mcp-sysinfo

      - name: Upload to release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release upload ${{ github.event.release.tag_name || inputs.tag }} \
            mcp-sysinfo-darwin-arm64 \
            --repo ${{ github.repository }} \
            --clobber

  slsa-mcp-sysinfo-windows-amd64:
    name: SLSA Build mcp-sysinfo windows-amd64
    needs: [prepare-build-metadata]
    permissions:
      id-token: write
      contents: write
      actions: read
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.1.0
    with:
      go-version: "1.22"
      config-file: .slsa-goreleaser/mcp-sysinfo-windows-amd64.yml
      evaluated-envs: "VERSION:${{ needs.prepare-build-metadata.outputs.version }}, COMMIT:${{ needs.prepare-build-metadata.outputs.commit }}, BUILD_DATE:${{ needs.prepare-build-metadata.outputs.build_date }}"
      upload-assets: true
      private-repository: true

  # ============================================
  # mcp-token-server builds
  # ============================================

  slsa-mcp-token-server-linux-amd64:
    name: SLSA Build mcp-token-server linux-amd64
    needs: [prepare-build-metadata]
    permissions:
      id-token: write
      contents: write
      actions: read
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.1.0
    with:
      go-version: "1.22"
      config-file: .slsa-goreleaser/mcp-token-server-linux-amd64.yml
      evaluated-envs: "VERSION:${{ needs.prepare-build-metadata.outputs.version }}, COMMIT:${{ needs.prepare-build-metadata.outputs.commit }}, BUILD_DATE:${{ needs.prepare-build-metadata.outputs.build_date }}"
      upload-assets: true
      private-repository: true

  slsa-mcp-token-server-linux-arm64:
    name: SLSA Build mcp-token-server linux-arm64
    needs: [prepare-build-metadata]
    permissions:
      id-token: write
      contents: write
      actions: read
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.1.0
    with:
      go-version: "1.22"
      config-file: .slsa-goreleaser/mcp-token-server-linux-arm64.yml
      evaluated-envs: "VERSION:${{ needs.prepare-build-metadata.outputs.version }}, COMMIT:${{ needs.prepare-build-metadata.outputs.commit }}, BUILD_DATE:${{ needs.prepare-build-metadata.outputs.build_date }}"
      upload-assets: true
      private-repository: true

  build-mcp-token-server-darwin-amd64:
    name: Build mcp-token-server darwin-amd64
    runs-on: macos-latest
    needs: [prepare-build-metadata]
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          ref: ${{ github.event.release.tag_name || inputs.tag }}

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}
          cache: true

      - name: Build
        env:
          CGO_ENABLED: 1
          GOOS: darwin
          GOARCH: amd64
        run: |
          go build -trimpath \
            -ldflags="-s -w -X main.version=${{ needs.prepare-build-metadata.outputs.version }} -X main.commit=${{ needs.prepare-build-metadata.outputs.commit }} -X main.date=${{ needs.prepare-build-metadata.outputs.build_date }}" \
            -o mcp-token-server-darwin-amd64 \
            ./cmd/mcp-token-server

      - name: Upload to release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release upload ${{ github.event.release.tag_name || inputs.tag }} \
            mcp-token-server-darwin-amd64 \
            --repo ${{ github.repository }} \
            --clobber

  build-mcp-token-server-darwin-arm64:
    name: Build mcp-token-server darwin-arm64
    runs-on: macos-latest
    needs: [prepare-build-metadata]
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          ref: ${{ github.event.release.tag_name || inputs.tag }}

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}
          cache: true

      - name: Build
        env:
          CGO_ENABLED: 1
          GOOS: darwin
          GOARCH: arm64
        run: |
          go build -trimpath \
            -ldflags="-s -w -X main.version=${{ needs.prepare-build-metadata.outputs.version }} -X main.commit=${{ needs.prepare-build-metadata.outputs.commit }} -X main.date=${{ needs.prepare-build-metadata.outputs.build_date }}" \
            -o mcp-token-server-darwin-arm64 \
            ./cmd/mcp-token-server

      - name: Upload to release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release upload ${{ github.event.release.tag_name || inputs.tag }} \
            mcp-token-server-darwin-arm64 \
            --repo ${{ github.repository }} \
            --clobber

  slsa-mcp-token-server-windows-amd64:
    name: SLSA Build mcp-token-server windows-amd64
    needs: [prepare-build-metadata]
    permissions:
      id-token: write
      contents: write
      actions: read
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.1.0
    with:
      go-version: "1.22"
      config-file: .slsa-goreleaser/mcp-token-server-windows-amd64.yml
      evaluated-envs: "VERSION:${{ needs.prepare-build-metadata.outputs.version }}, COMMIT:${{ needs.prepare-build-metadata.outputs.commit }}, BUILD_DATE:${{ needs.prepare-build-metadata.outputs.build_date }}"
      upload-assets: true
      private-repository: true

  # ============================================
  # Smoke Tests - verify binaries work on each platform
  # ============================================

  smoke-test-linux:
    name: Smoke Test Linux
    runs-on: ubuntu-latest
    needs:
      - slsa-mcp-sysinfo-linux-amd64
    steps:
      - name: Download binary from release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release download ${{ github.event.release.tag_name || inputs.tag }} \
            --repo ${{ github.repository }} \
            --pattern 'mcp-sysinfo-linux-amd64' \
            --skip-existing
          chmod +x mcp-sysinfo-linux-amd64

      - name: Test version
        run: ./mcp-sysinfo-linux-amd64 --version

      - name: Test core metrics
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_cpu_info --json
          ./mcp-sysinfo-linux-amd64 --query get_memory_info --json
          ./mcp-sysinfo-linux-amd64 --query get_disk_info --json
          ./mcp-sysinfo-linux-amd64 --query get_network_info --json
          ./mcp-sysinfo-linux-amd64 --query get_processes --json
          ./mcp-sysinfo-linux-amd64 --query get_uptime --json
          ./mcp-sysinfo-linux-amd64 --query get_temperature --json || true

      - name: Test log access
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_journal_logs --json || true
          ./mcp-sysinfo-linux-amd64 --query get_syslog --json || true
          ./mcp-sysinfo-linux-amd64 --query get_kernel_logs --json || true
          ./mcp-sysinfo-linux-amd64 --query get_auth_logs --json || true
          ./mcp-sysinfo-linux-amd64 --query get_app_logs --json || true

      - name: Test scheduled tasks
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_cron_jobs --json || true
          ./mcp-sysinfo-linux-amd64 --query get_startup_items --json || true
          ./mcp-sysinfo-linux-amd64 --query get_systemd_services --json || true

      - name: Test kernel
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_kernel_modules --json || true
          ./mcp-sysinfo-linux-amd64 --query get_loaded_drivers --json || true

      - name: Test network config
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_dns_servers --json
          ./mcp-sysinfo-linux-amd64 --query get_routes --json
          ./mcp-sysinfo-linux-amd64 --query get_firewall_rules --json || true
          ./mcp-sysinfo-linux-amd64 --query get_listening_ports --json
          ./mcp-sysinfo-linux-amd64 --query get_arp_table --json
          ./mcp-sysinfo-linux-amd64 --query get_network_stats --json

      - name: Test filesystem
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_mounts --json
          ./mcp-sysinfo-linux-amd64 --query get_disk_io --json || true
          ./mcp-sysinfo-linux-amd64 --query get_open_files --json || true
          ./mcp-sysinfo-linux-amd64 --query get_inode_usage --json

      - name: Test security config
        run: |
          ./mcp-sysinfo-linux-amd64 --query get_env_vars --json
          ./mcp-sysinfo-linux-amd64 --query get_user_accounts --json
          ./mcp-sysinfo-linux-amd64 --query get_sudo_config --json || true
          ./mcp-sysinfo-linux-amd64 --query get_ssh_config --json || true
          ./mcp-sysinfo-linux-amd64 --query get_mac_status --json || true
          ./mcp-sysinfo-linux-amd64 --query get_certificates --json || true

  smoke-test-darwin:
    name: Smoke Test Darwin
    runs-on: macos-latest
    needs:
      - build-mcp-sysinfo-darwin-arm64
    steps:
      - name: Download binary from release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release download ${{ github.event.release.tag_name || inputs.tag }} \
            --repo ${{ github.repository }} \
            --pattern 'mcp-sysinfo-darwin-arm64' \
            --skip-existing
          chmod +x mcp-sysinfo-darwin-arm64

      - name: Test version
        run: ./mcp-sysinfo-darwin-arm64 --version

      - name: Test core metrics
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_cpu_info --json
          ./mcp-sysinfo-darwin-arm64 --query get_memory_info --json
          ./mcp-sysinfo-darwin-arm64 --query get_disk_info --json
          ./mcp-sysinfo-darwin-arm64 --query get_network_info --json
          ./mcp-sysinfo-darwin-arm64 --query get_processes --json
          ./mcp-sysinfo-darwin-arm64 --query get_uptime --json
          ./mcp-sysinfo-darwin-arm64 --query get_temperature --json || true

      - name: Test log access
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_syslog --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_kernel_logs --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_auth_logs --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_app_logs --json || true

      - name: Test scheduled tasks
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_cron_jobs --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_startup_items --json || true

      - name: Test kernel
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_loaded_drivers --json || true

      - name: Test network config
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_dns_servers --json
          ./mcp-sysinfo-darwin-arm64 --query get_routes --json
          ./mcp-sysinfo-darwin-arm64 --query get_firewall_rules --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_listening_ports --json
          ./mcp-sysinfo-darwin-arm64 --query get_arp_table --json
          ./mcp-sysinfo-darwin-arm64 --query get_network_stats --json

      - name: Test filesystem
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_mounts --json
          ./mcp-sysinfo-darwin-arm64 --query get_disk_io --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_open_files --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_inode_usage --json

      - name: Test security config
        run: |
          ./mcp-sysinfo-darwin-arm64 --query get_env_vars --json
          ./mcp-sysinfo-darwin-arm64 --query get_user_accounts --json
          ./mcp-sysinfo-darwin-arm64 --query get_sudo_config --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_ssh_config --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_mac_status --json || true
          ./mcp-sysinfo-darwin-arm64 --query get_certificates --json || true

  smoke-test-windows:
    name: Smoke Test Windows
    runs-on: windows-latest
    needs:
      - slsa-mcp-sysinfo-windows-amd64
    steps:
      - name: Download binary from release
        env:
          GH_TOKEN: ${{ github.token }}
        shell: bash
        run: |
          gh release download ${{ github.event.release.tag_name || inputs.tag }} \
            --repo ${{ github.repository }} \
            --pattern 'mcp-sysinfo-windows-amd64' \
            --skip-existing

      - name: Test version
        run: .\mcp-sysinfo-windows-amd64 --version

      - name: Test core metrics
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_cpu_info --json
          .\mcp-sysinfo-windows-amd64 --query get_memory_info --json
          .\mcp-sysinfo-windows-amd64 --query get_disk_info --json
          .\mcp-sysinfo-windows-amd64 --query get_network_info --json
          .\mcp-sysinfo-windows-amd64 --query get_processes --json
          .\mcp-sysinfo-windows-amd64 --query get_uptime --json
          .\mcp-sysinfo-windows-amd64 --query get_temperature --json
        continue-on-error: true

      - name: Test log access
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_event_log --json
          .\mcp-sysinfo-windows-amd64 --query get_app_logs --json
        continue-on-error: true

      - name: Test scheduled tasks
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_scheduled_tasks --json
          .\mcp-sysinfo-windows-amd64 --query get_startup_items --json
        continue-on-error: true

      - name: Test kernel/drivers
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_loaded_drivers --json
        continue-on-error: true

      - name: Test network config
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_dns_servers --json
          .\mcp-sysinfo-windows-amd64 --query get_routes --json
          .\mcp-sysinfo-windows-amd64 --query get_firewall_rules --json
          .\mcp-sysinfo-windows-amd64 --query get_listening_ports --json
          .\mcp-sysinfo-windows-amd64 --query get_arp_table --json
          .\mcp-sysinfo-windows-amd64 --query get_network_stats --json
        continue-on-error: true

      - name: Test filesystem
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_mounts --json
          .\mcp-sysinfo-windows-amd64 --query get_disk_io --json
          .\mcp-sysinfo-windows-amd64 --query get_open_files --json
        continue-on-error: true

      - name: Test security config
        run: |
          .\mcp-sysinfo-windows-amd64 --query get_env_vars --json
          .\mcp-sysinfo-windows-amd64 --query get_user_accounts --json
          .\mcp-sysinfo-windows-amd64 --query get_certificates --json
        continue-on-error: true

  # ============================================
  # GitHub Attestations
  # ============================================

  github-attestations:
    name: Generate GitHub Attestations
    runs-on: ubuntu-latest
    needs:
      - slsa-mcp-sysinfo-linux-amd64
      - slsa-mcp-sysinfo-linux-arm64
      - slsa-mcp-sysinfo-windows-amd64
      - build-mcp-sysinfo-darwin-amd64
      - build-mcp-sysinfo-darwin-arm64
      - slsa-mcp-token-server-linux-amd64
      - slsa-mcp-token-server-linux-arm64
      - slsa-mcp-token-server-windows-amd64
      - build-mcp-token-server-darwin-amd64
      - build-mcp-token-server-darwin-arm64
      - smoke-test-linux
      - smoke-test-darwin
      - smoke-test-windows
    permissions:
      id-token: write
      contents: write
      attestations: write
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
        with:
          egress-policy: audit

      - name: Download release assets
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          # Download all binary assets from the release (not .intoto.jsonl files)
          gh release download ${{ github.event.release.tag_name || inputs.tag }} \
            --repo ${{ github.repository }} \
            --pattern 'mcp-*' \
            --skip-existing

          # List downloaded files
          ls -lh mcp-*

          # Exclude .intoto.jsonl files from attestation (they're already attestations)
          rm -f *.intoto.jsonl || true

      # mcp-sysinfo attestations
      - name: Attest mcp-sysinfo-linux-amd64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-sysinfo-linux-amd64

      - name: Attest mcp-sysinfo-linux-arm64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-sysinfo-linux-arm64

      - name: Attest mcp-sysinfo-darwin-amd64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-sysinfo-darwin-amd64

      - name: Attest mcp-sysinfo-darwin-arm64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-sysinfo-darwin-arm64

      - name: Attest mcp-sysinfo-windows-amd64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-sysinfo-windows-amd64

      # mcp-token-server attestations
      - name: Attest mcp-token-server-linux-amd64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-token-server-linux-amd64

      - name: Attest mcp-token-server-linux-arm64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-token-server-linux-arm64

      - name: Attest mcp-token-server-darwin-amd64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-token-server-darwin-amd64

      - name: Attest mcp-token-server-darwin-arm64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-token-server-darwin-arm64

      - name: Attest mcp-token-server-windows-amd64
        uses: actions/attest-build-provenance@c074443f1aee8d4aeeae555aebba3282517141b2 # v2.2.3
        with:
          subject-path: mcp-token-server-windows-amd64
